<div class="counter-recognizers"
     [formGroup]="countersForm">
  <form *ngFor="let counter of countersSchema"
        class="cr-wrapper"
        [formGroupName]="counter.formCtrlName">
    <h2 class="title"
        [ngClass]="counter.titleClass">
      {{ counter.title }}
    </h2>
    <mat-form-field appearance="fill">
      <mat-label>Стоимость</mat-label>
      <input formControlName="cost"
             matInput>
      <mat-error>{{getErrorMessage(countersForm.get([counter.formCtrlName, 'cost']))}}</mat-error>
    </mat-form-field>
    <app-counter-recognizer [brightness]="counter.brightness"
                            [contrast]="counter.contrast"
                            (ocrComplete)="countersForm.get([counter.formCtrlName, 'volume']).setValue($event)">
    </app-counter-recognizer>
    <mat-form-field appearance="fill">
      <mat-label>Счётчик</mat-label>
      <input formControlName="volume"
             matInput>
      <mat-error>{{getErrorMessage(countersForm.get([counter.formCtrlName, 'volume']))}}</mat-error>
    </mat-form-field>
  </form>
</div>

<app-bill *ngIf="newBill"
          [billData]="newBill">
</app-bill>

<div class="btn-panel">
  <button *ngIf="!newBill; else newBillActions"
          class="btn"
          color="primary"
          mat-raised-button
          [disabled]="!countersForm.valid"
          (click)="calculateBill()">
    Посчитать стоимость
  </button>

  <ng-template #newBillActions>
    <button class="btn"
            color="warn"
            mat-raised-button
            (click)="clearNewBill()">
      Отменить
    </button>
    <button class="btn"
            color="accent"
            mat-raised-button
            (click)="saveNewBill()">
      Сохранить
    </button>
  </ng-template>
</div>

